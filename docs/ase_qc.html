<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Lachlan Baer" />


<title>Allele Specific Expression Quality Control</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>





<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">210408_psen1_fADfAI_snv</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="de_analysis.html">DE analysis</a>
</li>
<li>
  <a href="de_enrichment.html">DE enrichment</a>
</li>
<li>
  <a href="ase_qc.html">ASE QC</a>
</li>
<li>
  <a href="ase_analysis.html">ASE analysis</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/baerlachlan/210408_psen1_fADfAI_snv">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Allele Specific Expression Quality Control</h1>
<h3 class="subtitle">210408_psen1_fADfAI dataset</h3>
<h4 class="author">Lachlan Baer</h4>
<h4 class="date">01 March, 2022</h4>

</div>


<div id="setup" class="section level1">
<h1>Setup</h1>
<pre class="r"><code>suppressPackageStartupMessages({
  ## Common
  library(tidyverse)
  library(magrittr)
  library(future.apply)
  library(here)
  library(AnnotationHub)
  library(purrr)
  library(scales)
  library(kableExtra)
  library(tictoc)
  library(ggrepel)
  library(RColorBrewer)
  library(ggpubr)
  library(pander)
  library(rmarkdown)
  ## Project specific
  library(UpSetR)
  library(SeqArray)
  library(ngsReports)
})</code></pre>
<pre class="r"><code>if (interactive()) setwd(here::here())
theme_set(theme_bw())
cores &lt;- availableCores() - 1</code></pre>
<pre class="r"><code>source(&quot;~/bioinformatics/bioToolkit/lbFuncs.R&quot;)</code></pre>
<pre class="r"><code>## Choose either local or remote project directory
# projDir &lt;- here()
projDir &lt;- &quot;/hpcfs/users/a1647910/210408_psen1_fADfAI&quot;</code></pre>
<div id="ensdb" class="section level2">
<h2>EnsDb</h2>
<pre class="r"><code>ah &lt;- AnnotationHub() %&gt;%
  subset(species == &quot;Danio rerio&quot;) %&gt;%
  subset(rdataclass == &quot;EnsDb&quot;)
ensDb &lt;- ah[[&quot;AH83189&quot;]] ## Ens101
genes &lt;- genes(ensDb)
mcols(genes) &lt;- mcols(genes)[
  c(&quot;gene_id&quot;, &quot;gene_name&quot;, &quot;gene_biotype&quot;, &quot;entrezid&quot;)
]
exons &lt;- exonsBy(ensDb, by = &quot;gene&quot;)</code></pre>
<p>An <code>EnsDb</code> object for Ensembl release 101 was setup for extracting gene and exon annotation information.</p>
</div>
<div id="metadata" class="section level2">
<h2>Metadata</h2>
<pre class="r"><code>metadata &lt;- read_csv(file.path(projDir, &quot;files/samples.csv&quot;)) %&gt;%
  dplyr::select(-sample) %&gt;%
  mutate(
    Genotype = factor(Genotype, levels = unique(Genotype)),
    basename = factor(basename, levels = basename),
    alias = c(
      paste0(rep(&quot;fAD&quot;, 7), seq(1, 7)),
      paste0(rep(&quot;fAI&quot;, 8), seq(1, 8)),
      paste0(rep(&quot;wt&quot;, 9), seq(1, 9))
    )
  ) %&gt;%
  dplyr::select(sample = basename, fish_id, batch_killed, sex = Sex, RINe,
                genotype = Genotype, genotype_2 = Genotype_2, alias)
metadata %&gt;%
  dplyr::select(
    Sample = sample, Genotype = genotype, Alias = alias, Gender = sex,
    `Fish ID` = fish_id, `Batch Killed` = batch_killed
  ) %&gt;%
  kable(
    align = &quot;l&quot;,
    caption = &quot;Sample metadata&quot;
  ) %&gt;%
  kable_styling(
    bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;)
  )</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Sample metadata
</caption>
<thead>
<tr>
<th style="text-align:left;">
Sample
</th>
<th style="text-align:left;">
Genotype
</th>
<th style="text-align:left;">
Alias
</th>
<th style="text-align:left;">
Gender
</th>
<th style="text-align:left;">
Fish ID
</th>
<th style="text-align:left;">
Batch Killed
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
7_KB_B12
</td>
<td style="text-align:left;">
EOfAD-like/+
</td>
<td style="text-align:left;">
fAD1
</td>
<td style="text-align:left;">
F
</td>
<td style="text-align:left;">
27
</td>
<td style="text-align:left;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
22_KB_C6
</td>
<td style="text-align:left;">
EOfAD-like/+
</td>
<td style="text-align:left;">
fAD2
</td>
<td style="text-align:left;">
F
</td>
<td style="text-align:left;">
30
</td>
<td style="text-align:left;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
16_KB_C12
</td>
<td style="text-align:left;">
EOfAD-like/+
</td>
<td style="text-align:left;">
fAD3
</td>
<td style="text-align:left;">
F
</td>
<td style="text-align:left;">
40
</td>
<td style="text-align:left;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
8_KB_B3
</td>
<td style="text-align:left;">
EOfAD-like/+
</td>
<td style="text-align:left;">
fAD4
</td>
<td style="text-align:left;">
F
</td>
<td style="text-align:left;">
46
</td>
<td style="text-align:left;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
19_KB_C3
</td>
<td style="text-align:left;">
EOfAD-like/+
</td>
<td style="text-align:left;">
fAD5
</td>
<td style="text-align:left;">
M
</td>
<td style="text-align:left;">
29
</td>
<td style="text-align:left;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
10_KB_B6
</td>
<td style="text-align:left;">
EOfAD-like/+
</td>
<td style="text-align:left;">
fAD6
</td>
<td style="text-align:left;">
M
</td>
<td style="text-align:left;">
50
</td>
<td style="text-align:left;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
4_KB_A6
</td>
<td style="text-align:left;">
EOfAD-like/+
</td>
<td style="text-align:left;">
fAD7
</td>
<td style="text-align:left;">
M
</td>
<td style="text-align:left;">
9
</td>
<td style="text-align:left;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
2_KB_A11
</td>
<td style="text-align:left;">
fAI-like/+
</td>
<td style="text-align:left;">
fAI1
</td>
<td style="text-align:left;">
F
</td>
<td style="text-align:left;">
12
</td>
<td style="text-align:left;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
12_KB_B8
</td>
<td style="text-align:left;">
fAI-like/+
</td>
<td style="text-align:left;">
fAI2
</td>
<td style="text-align:left;">
F
</td>
<td style="text-align:left;">
22
</td>
<td style="text-align:left;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
15_KB_C11
</td>
<td style="text-align:left;">
fAI-like/+
</td>
<td style="text-align:left;">
fAI3
</td>
<td style="text-align:left;">
F
</td>
<td style="text-align:left;">
45
</td>
<td style="text-align:left;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
18_KB_C2
</td>
<td style="text-align:left;">
fAI-like/+
</td>
<td style="text-align:left;">
fAI4
</td>
<td style="text-align:left;">
F
</td>
<td style="text-align:left;">
47
</td>
<td style="text-align:left;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
9_KB_B5
</td>
<td style="text-align:left;">
fAI-like/+
</td>
<td style="text-align:left;">
fAI5
</td>
<td style="text-align:left;">
M
</td>
<td style="text-align:left;">
21
</td>
<td style="text-align:left;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
6_KB_B11
</td>
<td style="text-align:left;">
fAI-like/+
</td>
<td style="text-align:left;">
fAI6
</td>
<td style="text-align:left;">
M
</td>
<td style="text-align:left;">
26
</td>
<td style="text-align:left;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
24_KB_C8
</td>
<td style="text-align:left;">
fAI-like/+
</td>
<td style="text-align:left;">
fAI7
</td>
<td style="text-align:left;">
M
</td>
<td style="text-align:left;">
44
</td>
<td style="text-align:left;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
21_KB_C5
</td>
<td style="text-align:left;">
fAI-like/+
</td>
<td style="text-align:left;">
fAI8
</td>
<td style="text-align:left;">
M
</td>
<td style="text-align:left;">
49
</td>
<td style="text-align:left;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
5_KB_A7
</td>
<td style="text-align:left;">
WT
</td>
<td style="text-align:left;">
wt1
</td>
<td style="text-align:left;">
F
</td>
<td style="text-align:left;">
19
</td>
<td style="text-align:left;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
1_KB_A10
</td>
<td style="text-align:left;">
WT
</td>
<td style="text-align:left;">
wt2
</td>
<td style="text-align:left;">
F
</td>
<td style="text-align:left;">
25
</td>
<td style="text-align:left;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
23_KB_C7
</td>
<td style="text-align:left;">
WT
</td>
<td style="text-align:left;">
wt3
</td>
<td style="text-align:left;">
F
</td>
<td style="text-align:left;">
36
</td>
<td style="text-align:left;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
3_KB_A1
</td>
<td style="text-align:left;">
WT
</td>
<td style="text-align:left;">
wt4
</td>
<td style="text-align:left;">
F
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
17_KB_C1
</td>
<td style="text-align:left;">
WT
</td>
<td style="text-align:left;">
wt5
</td>
<td style="text-align:left;">
M
</td>
<td style="text-align:left;">
34
</td>
<td style="text-align:left;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
20_KB_C4
</td>
<td style="text-align:left;">
WT
</td>
<td style="text-align:left;">
wt6
</td>
<td style="text-align:left;">
M
</td>
<td style="text-align:left;">
35
</td>
<td style="text-align:left;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
14_KB_C10
</td>
<td style="text-align:left;">
WT
</td>
<td style="text-align:left;">
wt7
</td>
<td style="text-align:left;">
M
</td>
<td style="text-align:left;">
37
</td>
<td style="text-align:left;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
13_KB_B9
</td>
<td style="text-align:left;">
WT
</td>
<td style="text-align:left;">
wt8
</td>
<td style="text-align:left;">
M
</td>
<td style="text-align:left;">
54
</td>
<td style="text-align:left;">
10
</td>
</tr>
<tr>
<td style="text-align:left;">
11_KB_B7
</td>
<td style="text-align:left;">
WT
</td>
<td style="text-align:left;">
wt9
</td>
<td style="text-align:left;">
M
</td>
<td style="text-align:left;">
55
</td>
<td style="text-align:left;">
10
</td>
</tr>
</tbody>
</table>
<pre class="r"><code>genoCols &lt;- metadata$genotype %&gt;%
  levels() %&gt;%
  length() %&gt;%
  brewer.pal(&quot;Set1&quot;) %&gt;%
  setNames(levels(metadata$genotype))
compCols &lt;- genoCols[1:2]</code></pre>
<pre class="r"><code>drChrs &lt;- seq(1:25)</code></pre>
</div>
</div>
<div id="gatk-short-variant-discovery" class="section level1">
<h1>GATK short variant discovery</h1>
<p>The <a href="https://gatk.broadinstitute.org/hc/en-us/articles/360035531192-RNAseq-short-variant-discovery-SNPs-Indels-">GATK best practices workflow for short variant discovery</a> was followed to produce variants calls in <code>VCF</code> format from raw RNA-seq <code>FASTQ</code> data. The following document describes the workflow and modifications implemented to reach the end goal of accurate allelic read counts for measurement of Allele Specific Expression (ASE).</p>
<div id="duplicates" class="section level2">
<h2>Duplicates</h2>
<p>Marking duplicates is important because almost all statistical models for variant calling assume some sort of independence between measurements. Duplicates that arise from PCR artifacts are not independent. Aligned reads were classified into duplicate groups based on their genomic coordinates and UMI sequence. This was performed with <code>UMI-tools group</code>, which tagged duplicate groups in the <code>BAM</code> file with the same <code>BX</code> tags. <code>Picard MarkDuplicates</code> was used to mark duplicates assigned to groups with the <code>--BARCODE_TAG</code> option. <code>MarkDuplicates</code> was set up to select the representative read for each group at random, as opposed to a base quality scoring strategy, such that reference allele mapping bias was avoided for downstream Allele Specific Expression (ASE) testing.</p>
<pre class="r"><code>dupeMetrics &lt;- list.files(
  file.path(projDir, &quot;analysis-variants/07_markDuplicates/samstats&quot;),
  full.names = TRUE
) %&gt;%
  lapply(function(x){
    sample &lt;- basename(x) %&gt;%
      str_remove(&quot;.tsv&quot;)
    metrics &lt;- read_lines(x)
    grep(&quot;^SN&quot;, metrics, value = TRUE) %&gt;%
      str_split(&quot;\t&quot;, simplify = TRUE) %&gt;%
      .[, 2:3] %&gt;%
      set_colnames(c(&quot;metric&quot;, &quot;value&quot;)) %&gt;%
      as_tibble() %&gt;%
      mutate(metric = str_remove(metric, &quot;:$&quot;)) %&gt;%
      pivot_wider(names_from = &quot;metric&quot;, values_from = &quot;value&quot;) %&gt;%
      mutate(
        across(everything(), as.numeric),
        sample = sample,
        percent.duplication = `reads duplicated` / `reads mapped and paired`
      )
  }) %&gt;%
  bind_rows()</code></pre>
<p>Between <em>27.59%</em> and <em>41.16%</em> of reads were marked as duplicates across all samples.</p>
</div>
<div id="base-quality-score-recalibration" class="section level2">
<h2>Base quality score recalibration</h2>
<p>Base quality score recalibration (BQSR) is a recommended technique in the <code>GATK</code> workflow which is used to assign accurate confidence scores to each sequenced base. Real data contains systematic biases due to artifacts of sample preparation, sequencing and mapping. BQSR aims to correct for the range of these types of artifacts, as downstream tools rely on base qualities to weigh the variant calls they make. The process involves two keys steps performed by tools <code>BaseRecalibrator</code> and <code>ApplyBQSR</code> in the <code>GATK</code> suite.</p>
<p><strong>BaseRecalibrator</strong></p>
<p><code>BaseRecalibrator</code> builds a model of covariation based on the input data and a set of known variants. The set of known variants for this analysis was retrieved from the <a href="https://asia.ensembl.org/info/genome/variation/index.html">Ensembl Variation database</a>. It is also possible to generate a set of known variants from the data itself if a reference is not available. Details about this procedure are described <a href="https://gatk.broadinstitute.org/hc/en-us/articles/360035890531-Base-Quality-Score-Recalibration-BQSR-">here</a>. <code>BaseRecalibrator</code> records data about the following features of aligned bases:</p>
<ul>
<li>Read group</li>
<li>Quality score</li>
<li>Machine cycle producing the base (Nth cycle = Nth base from the start of the read)</li>
<li>Dinucleotide context (current base + previous base)</li>
</ul>
<p>For each bin, the number of bases and how often such bases mistmatch the reference are counted and exported as a recalibration report.</p>
<p><strong>ApplyBQSR</strong></p>
<p><code>ApplyBQSR</code> uses the recalibration file to go through the reads and adjust each base’s score depending on what bins it falls in. The new quality score is effectively determined by:</p>
<ul>
<li>The sum of the global difference between reported quality scores and the empirical quality</li>
<li>plus the quality bin specific shift</li>
<li>plus the cycle x quality and dinucleotide x quality effect</li>
</ul>
<p>Recalibration should cause the read quality scores to match their empirical scores much closer than before. This allows for more statistically robust downstream variant calling.</p>
<pre class="r"><code>files &lt;- list.files(
  file.path(projDir, &quot;analysis-variants/04_addRG/samstats&quot;),
  full.names = TRUE
)
beforeRecalMetrics &lt;- lapply(files, read_lines) %&gt;%
  set_names(str_remove(basename(files), &quot;.tsv&quot;))
beforeRecalSummary &lt;- map2(beforeRecalMetrics, files, function(.x, .y){
  grep(&quot;^SN&quot;, .x, value = TRUE) %&gt;%
    str_split(&quot;\t&quot;, simplify = TRUE) %&gt;%
    .[, 2:3] %&gt;%
    set_colnames(c(&quot;metric&quot;, &quot;value&quot;)) %&gt;%
    as_tibble() %&gt;%
    mutate(metric = str_remove(metric, &quot;:$&quot;)) %&gt;%
    pivot_wider(names_from = &quot;metric&quot;, values_from = &quot;value&quot;) %&gt;%
    mutate(
      across(everything(), as.numeric),
      sample = str_remove(basename(.y), &quot;.tsv&quot;)
    )
}) %&gt;%
  bind_rows()
beforeRecalQuality &lt;- map2(beforeRecalMetrics, files, function(.x, .y){
  grep(&quot;^FFQ&quot;, .x, value = TRUE) %&gt;%
    str_split(&quot;\t&quot;, simplify = TRUE) %&gt;%
    .[,-1] %&gt;%
    set_colnames(c(&quot;cycle&quot;, paste0(&quot;BQ&quot;, seq(0, ncol(.) - 2)))) %&gt;%
    as_tibble() %&gt;%
    mutate(across(everything(), as.numeric)) %&gt;%
    .[, colSums(.) != 0] %&gt;%
    mutate(
      cycle = as.factor(cycle),
      sample = str_remove(basename(.y), &quot;.tsv&quot;)
    ) 
})</code></pre>
<pre class="r"><code>files &lt;- list.files(
  file.path(projDir, &quot;analysis-variants/09_bqsr/metrics&quot;),
  full.names = TRUE
)
afterRecalMetrics &lt;- lapply(files, read_lines) %&gt;%
  set_names(str_remove(basename(files), &quot;.tsv&quot;))
afterRecalSummary &lt;- map2(afterRecalMetrics, files, function(.x, .y){
  grep(&quot;^SN&quot;, .x, value = TRUE) %&gt;%
    str_split(&quot;\t&quot;, simplify = TRUE) %&gt;%
    .[, 2:3] %&gt;%
    set_colnames(c(&quot;metric&quot;, &quot;value&quot;)) %&gt;%
    as_tibble() %&gt;%
    mutate(metric = str_remove(metric, &quot;:$&quot;)) %&gt;%
    pivot_wider(names_from = &quot;metric&quot;, values_from = &quot;value&quot;) %&gt;%
    mutate(
      across(everything(), as.numeric),
      sample = str_remove(basename(.y), &quot;.tsv&quot;)
    )
}) %&gt;%
  bind_rows()
afterRecalQuality &lt;- map2(afterRecalMetrics, files, function(.x, .y){
  grep(&quot;^FFQ&quot;, .x, value = TRUE) %&gt;%
    str_split(&quot;\t&quot;, simplify = TRUE) %&gt;%
    .[,-1] %&gt;%
    set_colnames(c(&quot;cycle&quot;, paste0(&quot;BQ&quot;, seq(0, ncol(.) - 2)))) %&gt;%
    as_tibble() %&gt;%
    mutate(across(everything(), as.numeric)) %&gt;%
    .[, colSums(.) != 0] %&gt;%
    mutate(
      cycle = as.factor(cycle),
      sample = str_remove(basename(.y), &quot;.tsv&quot;)
    ) 
})</code></pre>
<p>For successful recalibration it is critical that each read group (sample in this case) has more than 100 million aligned bases. For this dataset the number of aligned bases ranged between <em>5,994,962,190</em> and <em>9,095,498,518</em> across all samples, and therefore base recalibration was performed.</p>
<pre class="r"><code>files &lt;- list.files(
  file.path(projDir, &quot;analysis-variants/09_bqsr/recal&quot;),
  pattern = &quot;analyzeCovariates&quot;,
  full.names = TRUE
)
recalCovariates &lt;- lapply(files, function(x){
  read_csv(x) %&gt;%
    mutate(sample = str_remove(basename(x), &quot;.analyzeCovariates.csv&quot;))
})</code></pre>
<p>To assess whether base recalibration was successful, base qualities were assessed before and after recalibration. As all samples showed similar profiles, a representative sample for each genotype is shown below.</p>
<pre class="r"><code>lapply(recalCovariates[c(1, 9, 15, 19)], function(x){
  x %&gt;%
    dplyr::filter(CovariateName == &quot;QualityScore&quot;) %&gt;%
    left_join(metadata[, c(&quot;sample&quot;, &quot;genotype&quot;)]) %&gt;%
    mutate(facet = paste(sample, &quot;-&quot;, genotype))
}) %&gt;%
  bind_rows() %&gt;%
  ggplot(aes(AverageReportedQuality, EmpiricalQuality)) +
  geom_point(aes(colour = Recalibration), alpha = 0.7) +
  geom_abline(intercept = 0, slope = 1, linetype = 2) + 
  xlab(&quot;Reported Quality Score&quot;) +
  ylab(&quot;Empirical Quality Score&quot;) +
  scale_colour_manual(values = c(&quot;Before&quot; = &quot;maroon1&quot;, &quot;After&quot; = &quot;blue&quot;)) +
  facet_wrap(~facet, nrow = 1) +
  theme(
    legend.position = &quot;bottom&quot;,
    strip.text.x = element_text(size = 7)
  )</code></pre>
<div class="figure" style="text-align: center">
<img src="ase_qc_files/figure-html/unnamed-chunk-10-1.png" alt="*Reported base quality plotted against empirical quality. Base qualities before recalibration showed patterns of over-estimation by the sequencer. Post-recalibration quality scores fitted the empirically derived quality scores better than pre-recalibration. Additionally a greater distribution of quality scores was observed after recalibration procedures.*" width="768" />
<p class="caption">
<em>Reported base quality plotted against empirical quality. Base qualities before recalibration showed patterns of over-estimation by the sequencer. Post-recalibration quality scores fitted the empirically derived quality scores better than pre-recalibration. Additionally a greater distribution of quality scores was observed after recalibration procedures.</em>
</p>
</div>
<pre class="r"><code>lapply(recalCovariates[c(1, 9, 15, 19)], function(x){
  x %&gt;%
    dplyr::filter(CovariateName == &quot;Cycle&quot;) %&gt;%
    left_join(metadata[, c(&quot;sample&quot;, &quot;genotype&quot;)]) %&gt;%
    mutate(
      CovariateValue = factor(CovariateValue, levels = unique(CovariateValue)),
      facet = paste(sample, &quot;-&quot;, genotype)
    )
}) %&gt;%
  bind_rows() %&gt;%
  ggplot(aes(CovariateValue, Accuracy)) +
  geom_point(aes(colour = Recalibration), alpha = 0.7)+
  geom_abline(intercept = 0, slope = 0, linetype = 2) + 
  xlab(&quot;Machine Cycle&quot;) +
  ylab(&quot;Quality Score Accuracy (Empirical - Reported)&quot;) +
  scale_colour_manual(values = c(&quot;Before&quot; = &quot;maroon1&quot;, &quot;After&quot; = &quot;blue&quot;)) +
  scale_x_discrete(breaks = seq(0, 100, 5)) +
  coord_cartesian(ylim = c(-10, 10)) +
  facet_wrap(~facet, nrow = 1) +
  theme(
    legend.position = &quot;bottom&quot;,
    strip.text.x = element_text(size = 7),
    axis.text.x = element_text(size = 6, angle = 270, hjust = 0)
  )</code></pre>
<div class="figure" style="text-align: center">
<img src="ase_qc_files/figure-html/unnamed-chunk-11-1.png" alt="*Residual error by machine cycle. Observations before recalibration are coloured pink and after recalibration are blue. Most cycles showed an overestimation of base qualities which was improved after recalibration.*" width="768" />
<p class="caption">
<em>Residual error by machine cycle. Observations before recalibration are coloured pink and after recalibration are blue. Most cycles showed an overestimation of base qualities which was improved after recalibration.</em>
</p>
</div>
<pre class="r"><code>lapply(recalCovariates[c(1, 9, 15, 19)], function(x){
  x %&gt;%
    dplyr::filter(CovariateName == &quot;Context&quot;) %&gt;%
    left_join(metadata[, c(&quot;sample&quot;, &quot;genotype&quot;)]) %&gt;%
    mutate(
      CovariateValue = factor(CovariateValue, levels = unique(CovariateValue)),
      facet = paste(sample, &quot;-&quot;, genotype)
    )
}) %&gt;%
  bind_rows() %&gt;%
  ggplot(aes(CovariateValue, Accuracy, colour = Recalibration)) +
  geom_point(alpha = 0.7, shape = &quot;\U2012&quot;, size = 5)+
  geom_abline(intercept = 0, slope = 0, linetype = 2) + 
  xlab(&quot;Dinucleotide&quot;) +
  ylab(&quot;Quality Score Accuracy (Empirical - Reported)&quot;) +
  scale_colour_manual(values = c(&quot;Before&quot; = &quot;maroon1&quot;, &quot;After&quot; = &quot;blue&quot;)) +
  coord_cartesian(ylim = c(-10, 10)) +
  facet_wrap(~facet, nrow = 1) +
  theme(
    legend.position = &quot;bottom&quot;,
    strip.text.x = element_text(size = 7),
    axis.text.x = element_text(size = 6, angle = 270, hjust = 0)
  )</code></pre>
<div class="figure" style="text-align: center">
<img src="ase_qc_files/figure-html/unnamed-chunk-12-1.png" alt="*Residual error by dinucleotide. Observations before recalibration are coloured pink and after recalibration are blue. Dinucleotide contexts showed over-estimation of base qualities pre-recalibration but were substantially improved after recalibration.*" width="768" />
<p class="caption">
<em>Residual error by dinucleotide. Observations before recalibration are coloured pink and after recalibration are blue. Dinucleotide contexts showed over-estimation of base qualities pre-recalibration but were substantially improved after recalibration.</em>
</p>
</div>
</div>
<div id="genomic-location" class="section level2">
<h2>Genomic location</h2>
<p>Variants were restricted to those that lie only in exonic regions of the Ensembl version 101 primary assembly. For zebrafish this consists of chromosomes 1 to 25. To perform this within the <code>GATK</code>’s tools, an interval list was created containing the exonic ranges. A number of interval list formats are supported by GATK as described <a href="https://gatk.broadinstitute.org/hc/en-us/articles/360035531852-Intervals-and-interval-lists">here</a>. The GATK-style <code>.intervals</code> is poorly described but requires the format <code>&lt;chr&gt;:&lt;start&gt;-&lt;end&gt;</code> e.g. <code>1:1367-1367</code> for a singular base position. The nomenclature must match that of the chosen reference, for example, Ensembl labels chromosome 1 as “1”, not “chr1”. The GATK-style format was chosen for its simplicity.</p>
<p>Defining intervals before calling variants also has the advantage of a large speed-up in computational processing time. <code>HaplotypeCaller</code> is the longest step in the <code>GATK</code> short variant discovery pipeline, sometimes taking over a day to process for large datasets on a HPC system when interval lists are not utilised.</p>
<p>The construction of this interval list was implemented inside the <code>snakemake</code> workflow as a custom <code>R</code> script (<a href="https://github.com/baerlachlan/210408_psen1_fADfAI/blob/master/analysis-variants/smk/scripts/intervals.R">GitHub link</a>).</p>
</div>
<div id="variant-calling" class="section level2">
<h2>Variant calling</h2>
<p>With the intention to perform downstream ASE analysis, initial variants were restricted to only biallelic SNVs.</p>
<p>Additionally, for RNA-seq data, the <code>GATK</code> recommends <a href="https://gatk.broadinstitute.org/hc/en-us/articles/360035890471-Hard-filtering-germline-short-variants">specific hard filters</a>. Variants were removed with the following filters:</p>
<ul>
<li>QualByDepth: QD &lt; 2.0</li>
<li>Variant confidence (QUAL field) divided by the unfiltered depth of non-homozygous reference samples. Removing variants that have a low QD normalises the variant quality and avoids inflation caused by deep coverage.</li>
<li>FisherStrand: FS &gt; 60.0</li>
<li>The Phred-scaled probability there there is strand bias at the site. Strand bias indicates whether the alternate allele was seen more or less often on the forward or reverse strand than the reference allele. When there is little to no strand bias at the site, the FS value is close to 0.</li>
<li>StrandOddsRatio: SOR &gt; 4.0</li>
<li>An alternative way to estimate strand bias using a test similar to the symmetric odds ratio test.</li>
<li>RMSMappingQuality: MQ &lt; 40.0</li>
<li>Root mean square mapping quality over all the reads at the site.</li>
<li>MappingQualityRankSumTest: MQRankSum &lt; -12.5</li>
<li>u-based z-approximation from the Rank Sum Test for mapping qualities. This compares the mapping qualities of the reads supporting the reference allele and the alternate allele.</li>
<li>ReadPosRankSumTest: ReadPosRankSum &lt; -8.0</li>
<li>u-based z-approximation from the Rank Sum Test for site position within reads. This compares whether the positions of the reference and alternate alleles are different within the reads.</li>
</ul>
<pre class="r"><code>calledMetrics &lt;- list.files(
  path = file.path(projDir, &quot;analysis-variants/10_variants/1_gvcf/log&quot;),
  pattern = &quot;detail&quot;,
  full.names = TRUE
) %&gt;%
  lapply(read_tsv, comment = &quot;#&quot;) %&gt;%
  bind_rows() %&gt;%
  dplyr::select(-contains(c(&quot;DBSNP&quot;, &quot;DB_SNP&quot;, &quot;NOVEL&quot;))) %&gt;%
  as.data.frame()
extractedMetrics &lt;- list.files(
  path = file.path(projDir, &quot;analysis-variants/10_variants/4_extract/log&quot;),
  pattern = &quot;detail&quot;,
  full.names = TRUE
) %&gt;%
  lapply(read_tsv, comment = &quot;#&quot;) %&gt;%
  bind_rows() %&gt;%
  dplyr::select(-contains(c(&quot;DBSNP&quot;, &quot;DB_SNP&quot;, &quot;NOVEL&quot;))) %&gt;%
  as.data.frame()
filteredMetrics &lt;- list.files(
  path = file.path(projDir, &quot;analysis-variants/10_variants/5_filter/log&quot;),
  pattern = &quot;detail&quot;,
  full.names = TRUE
) %&gt;%
  lapply(read_tsv, comment = &quot;#&quot;) %&gt;%
  bind_rows() %&gt;%
  dplyr::select(-contains(c(&quot;DBSNP&quot;, &quot;DB_SNP&quot;, &quot;NOVEL&quot;))) %&gt;%
  as.data.frame()
selectedMetrics &lt;- list.files(
  path = file.path(projDir, &quot;analysis-variants/10_variants/6_select/log&quot;),
  pattern = &quot;detail&quot;,
  full.names = TRUE
) %&gt;%
  lapply(read_tsv, comment = &quot;#&quot;) %&gt;%
  bind_rows() %&gt;%
  dplyr::select(-contains(c(&quot;DBSNP&quot;, &quot;DB_SNP&quot;, &quot;NOVEL&quot;))) %&gt;%
  as.data.frame()</code></pre>
<pre class="r"><code>filtProgress &lt;- calledMetrics %&gt;%
  as_tibble() %&gt;%
  dplyr::select(sample = SAMPLE_ALIAS, initial = TOTAL_SNPS)
filtProgress &lt;- selectedMetrics %&gt;%
  as_tibble() %&gt;%
  dplyr::select(sample = SAMPLE_ALIAS, GATK = TOTAL_SNPS) %&gt;%
  left_join(filtProgress)</code></pre>
<p>After <code>GATK</code> recommended hard filters were applied the number of biallelic SNVs ready for ASE analysis ranged between <em>200,356</em> and <em>216,591</em>.</p>
</div>
</div>
<div id="allele-specific-expression" class="section level1">
<h1>Allele Specific Expression</h1>
<p>There are a number of important quality control measures that must be taken to ensure reliable data for allele specific expression (ASE) testing. The following procedures are based around the guidelines described in <a href="https://www.biorxiv.org/content/biorxiv/early/2015/03/05/016097.full.pdf">Castel et al. Tools and Best Practices for allelic expression analysis.</a></p>
<div id="wasp" class="section level3">
<h3>WASP</h3>
<p>Read mapping is a potential source of bias for ASE analysis. For RNA-seq data mapped to a reference genome, reads that carry an alternate allele at positions of variation have at least one mismatch, and therefore a lower probability of aligning correctly than reads containing the reference allele.</p>
<p><code>WASP</code> provides a suite of tools for unbiased allele-specific read mapping. The <code>WASP</code> workflow for mappability filtering is defined by 5 steps:</p>
<ol style="list-style-type: decimal">
<li>Reads are mapped normally with the user’s mapper of choice (<code>STAR</code> was chosen in this case).</li>
<li>Reads that overlap identified SNVs and therefore may have mapping bias are determined using <code>find_intersecting_snps.py</code> script. Each overlapping read is output as a set of synthetic reads in <code>FASTQ</code> format with its allele swapped to to the other allele at the SNV site.</li>
<li>The set of allele-swapped reads are re-mapped using the same method and options used in step 1.</li>
<li>Reads where one or more allelic versions fail to map back to the same location are removed using <code>filter_remapped_reads.py</code> script.</li>
<li>Reads that did not overlap SNVs are merged with those that show unbiased mapping from step 4 using <code>samtools</code>, resulting in a complete set of mappability-filtered aligned reads in <code>BAM</code> format.</li>
</ol>
<p>To begin the <code>WASP</code> filtering procedure, input files containing genetic variants (SNVs) previously identified by the <code>GATK</code> workflow are needed. Since we do not have phasing information, it is recommended to use text-based format opposed to <code>HDF5</code> for the input files. The text-based input files require three space-delimited columns (position, ref_allele, alt_allele), and one input file per chromosome. The filenames must follow the convention <code>&lt;chr&gt;.snps.txt.gz</code> (e.g <code>1.snps.txt.gz</code> for chromosome 1). This was implemented in the <code>snakemake</code> workflow as a custom <code>R</code> script.</p>
<p>Text-based input files were created within the <code>snakemake</code> workflow as a custom <code>R</code> script. <code>WASP</code> filtering was subsequently performed on the HPC system. The resulting <code>BAM</code> files were then ready for allele specific expression read counting with <code>ASEReadCounter</code>.</p>
</div>
<div id="asereadcounter" class="section level3">
<h3>ASEReadCounter</h3>
<p>The <code>GATK</code>’s <code>ASEReadCounter</code> tool calculates allele counts at a set of positions after applying filters specifically tuned for ASE analysis of RNA-seq data. The filters operate on mapping quality, base quality, depth of coverage and overlapping paired reads. Each of these filters can be controlled by command-line arguments. The data in this analysis was generated with the following options:</p>
<ul>
<li><code>--min-mapping-quality 10</code></li>
<li><code>--min-base-quality 20</code></li>
<li><code>--count-overlap-reads-handling COUNT_FRAGMENTS_REQUIRE_SAME_BASE</code></li>
<li>Ths option counts all fragments where the base is consistent when mate pairs overlap.</li>
<li><code>--min-depth-of-non-filtered-base -1</code></li>
<li>This argument is disabled, because depth filtering was performed manually (see next section: Coverage).</li>
</ul>
<p><code>ASEReadCounter</code> was run on <code>BAM</code> alignment files that were subject to <code>WASP</code> filtering and also alignment files that had not been <code>WASP</code> filtered, to compare whether the filtering procedure improves any observable reference allele mapping bias. Heterozygous SNVs detected by <code>ASEReadCounter</code> were recorded in separate <code>tsv</code> files for each sample. These were loaded into R as a list of tibbles containing allele count data for ASE analysis.</p>
<pre class="r"><code>files_nowasp &lt;- list.files(
  file.path(projDir, &quot;analysis-variants/12_aseRC/no_wasp&quot;),
  full.names = TRUE
)
samples &lt;- basename(files_nowasp) %&gt;%
  str_remove(&quot;.tsv&quot;)
aseRC_nowasp &lt;- lapply(files_nowasp, function(file){
  sample &lt;- basename(file) %&gt;%
    str_remove(&quot;.tsv&quot;)
  read_tsv(
    file,
    col_types = &quot;cdcccdddddddd&quot;
  ) %&gt;%
    mutate(
      sample = sample,
      allele = paste0(refAllele, &quot;,&quot;, altAllele)
    ) %&gt;%
    left_join(metadata[,c(&quot;sample&quot;, &quot;genotype&quot;)]) %&gt;%
    dplyr::select(
      chromosome = contig, position, allele, refCount, altCount, totalCount,
      sample, genotype, lowMAPQDepth, lowBaseQDepth, rawDepth, otherBases,
      improperPairs, refAllele, altAllele
    )
}) %&gt;% 
  set_names(samples)</code></pre>
<pre class="r"><code>files_wasp &lt;- list.files(
  file.path(projDir, &quot;analysis-variants/12_aseRC/wasp&quot;),
  full.names = TRUE
)
aseRC_wasp &lt;- lapply(files_wasp, function(file){
  sample &lt;- basename(file) %&gt;%
    str_remove(&quot;.tsv&quot;)
  read_tsv(
    file,
    col_types = &quot;cdcccdddddddd&quot;
  ) %&gt;%
    mutate(
      sample = sample,
      allele = paste0(refAllele, &quot;,&quot;, altAllele)
    ) %&gt;%
    left_join(metadata[,c(&quot;sample&quot;, &quot;genotype&quot;)]) %&gt;%
    dplyr::select(
      chromosome = contig, position, allele, refCount, altCount, totalCount,
      sample, genotype, lowMAPQDepth, lowBaseQDepth, rawDepth, otherBases,
      improperPairs, refAllele, altAllele
    )
}) %&gt;% 
  set_names(samples)</code></pre>
<pre class="r"><code>filtProgress &lt;- list(
  nowasp = aseRC_nowasp %&gt;%
    bind_rows() %&gt;%
    group_by(sample) %&gt;%
    summarise(
      aseRC = n()
    ) %&gt;%
    left_join(filtProgress),
  wasp = aseRC_wasp %&gt;%
    bind_rows() %&gt;%
    group_by(sample) %&gt;%
    summarise(
      software = n()
    ) %&gt;%
    left_join(filtProgress)
)</code></pre>
</div>
<div id="coverage" class="section level3">
<h3>Coverage</h3>
<p>SNV sites with low read coverage are uninformative, and therefore were filtered. To determine the optimal read coverage value for filtering, the effects of potential cut-offs were inspected.</p>
<pre class="r"><code>covBins_nowasp &lt;- lapply(aseRC_nowasp, function(x){
  n0 &lt;- nrow(dplyr::filter(x, totalCount &gt;= 0))
  n10 &lt;- nrow(dplyr::filter(x, totalCount &gt;= 10))
  n20 &lt;- nrow(dplyr::filter(x, totalCount &gt;= 20))
  n30 &lt;- nrow(dplyr::filter(x, totalCount &gt;= 30))
  n40 &lt;- nrow(dplyr::filter(x, totalCount &gt;= 40))
  n50 &lt;- nrow(dplyr::filter(x, totalCount &gt;= 50))
  sample &lt;- unique(x$sample)
  tibble(
    bin = c(&quot;\u2265 0&quot;, &quot;\u2265 10&quot;, &quot;\u2265 20&quot;, &quot;\u2265 30&quot;, &quot;\u2265 40&quot;, &quot;\u2265 50&quot;),
    n = c(n0, n10, n20, n30, n40, n50),
    sample = sample,
    wasp = &quot;Without WASP filtering&quot;
  )
}) %&gt;%
  bind_rows()
covBins_wasp &lt;- lapply(aseRC_wasp, function(x){
  n0 &lt;- nrow(dplyr::filter(x, totalCount &gt;= 0))
  n10 &lt;- nrow(dplyr::filter(x, totalCount &gt;= 10))
  n20 &lt;- nrow(dplyr::filter(x, totalCount &gt;= 20))
  n30 &lt;- nrow(dplyr::filter(x, totalCount &gt;= 30))
  n40 &lt;- nrow(dplyr::filter(x, totalCount &gt;= 40))
  n50 &lt;- nrow(dplyr::filter(x, totalCount &gt;= 50))
  sample &lt;- unique(x$sample)
  tibble(
    bin = c(&quot;\u2265 0&quot;, &quot;\u2265 10&quot;, &quot;\u2265 20&quot;, &quot;\u2265 30&quot;, &quot;\u2265 40&quot;, &quot;\u2265 50&quot;),
    n = c(n0, n10, n20, n30, n40, n50),
    sample = sample,
    wasp = &quot;With WASP filtering&quot;
  )
}) %&gt;%
  bind_rows()</code></pre>
<pre class="r"><code>bind_rows(covBins_nowasp, covBins_wasp) %&gt;%
  mutate(wasp = factor(wasp, levels = c(
    &quot;Without WASP filtering&quot;, &quot;With WASP filtering&quot;
  ))) %&gt;%
  ggplot(aes(bin, n, fill = bin)) +
  geom_boxplot() +
  labs(x = &quot;Reads / SNV&quot;, y = &quot;Number of SNVs&quot;) +
  theme(legend.position = &quot;none&quot;) +
  facet_wrap(~wasp)</code></pre>
<div class="figure" style="text-align: center">
<img src="ase_qc_files/figure-html/unnamed-chunk-20-1.png" alt="*The number of SNVs per sample that satisfy read coverage cut-offs*" width="768" />
<p class="caption">
<em>The number of SNVs per sample that satisfy read coverage cut-offs</em>
</p>
</div>
<p>A cut-off of at least 10 counts per SNV position was applied, as it provides a reasonable estimate of ASE while keeping as many SNVs as possible.</p>
<pre class="r"><code>aseRC_wasp &lt;- lapply(aseRC_wasp, function(x){
  dplyr::filter(x, totalCount &gt;= 10)
})
aseRC_nowasp &lt;- lapply(aseRC_nowasp, function(x){
  dplyr::filter(x, totalCount &gt;= 10)
})</code></pre>
<pre class="r"><code>filtProgress &lt;- list(
  nowasp = aseRC_nowasp %&gt;%
    bind_rows() %&gt;%
    group_by(sample) %&gt;%
    summarise(
      coverage = n()
    ) %&gt;%
    left_join(filtProgress$nowasp),
  wasp = aseRC_wasp %&gt;%
    bind_rows() %&gt;%
    group_by(sample) %&gt;%
    summarise(
      coverage = n()
    ) %&gt;%
    left_join(filtProgress$wasp)
)</code></pre>
</div>
<div id="mono-allelic-expression" class="section level3">
<h3>Mono-allelic expression</h3>
<p>Producing evidence of mono-allelic expression from short read RNA-seq datasets without parental genotypes or imprinting information is a controversial issue. SNV sites were therefore filtered based on a depth criteria for each allele (<span class="math inline">\(\ge\)</span> 3 counts or <span class="math inline">\(&gt;\)</span> 1% of the total counts for that allele).</p>
<pre class="r"><code>aseRC_wasp &lt;- lapply(aseRC_wasp, function(x){
  dplyr::filter(
    x,
    refCount &gt;= 3,
    altCount &gt;= 3,
    refCount / totalCount &gt; 0.01,
    altCount / totalCount &gt; 0.01
  )
})
aseRC_nowasp &lt;- lapply(aseRC_nowasp, function(x){
  dplyr::filter(
    x,
    refCount &gt;= 3,
    altCount &gt;= 3,
    refCount / totalCount &gt; 0.01,
    altCount / totalCount &gt; 0.01
  )
})</code></pre>
<pre class="r"><code>filtProgress &lt;- list(
  nowasp = aseRC_nowasp %&gt;%
    bind_rows() %&gt;%
    group_by(sample) %&gt;%
    summarise(
      monoallelic = n()
    ) %&gt;%
    left_join(filtProgress$nowasp),
  wasp = aseRC_wasp %&gt;%
    bind_rows() %&gt;%
    group_by(sample) %&gt;%
    summarise(
      monoallelic = n()
    ) %&gt;%
    left_join(filtProgress$wasp)
)</code></pre>
</div>
</div>
<div id="summary" class="section level1">
<h1>Summary</h1>
<div id="reference-mapping-bias" class="section level3">
<h3>Reference mapping bias</h3>
<p><code>WASP</code> filtering is designed to remove the vast majority of reads with mapping bias. Reference allele ratios were calculated for all SNVs passing filtering procedures with and without <code>WASP</code> filtering, to determine the effectiveness of <code>WASP</code>. A residual mapping bias is indicated if reference allele ratios tend to deviate from 0.5.</p>
<pre class="r"><code>refRatios_nowasp &lt;- lapply(aseRC_nowasp, function(x){
  x %&gt;%
    dplyr::filter(totalCount != 0) %&gt;%
    mutate(
      refRatio = refCount / totalCount,
      altRatio = altCount / totalCount,
      WASP = FALSE
    ) %&gt;%
    dplyr::select(
      chromosome, position, allele, refRatio, altRatio, totalCount,
      sample, genotype, WASP
    )
}) %&gt;%
  bind_rows()</code></pre>
<pre class="r"><code>refRatios_wasp &lt;- lapply(aseRC_wasp, function(x){
  x %&gt;%
    dplyr::filter(totalCount != 0) %&gt;%
    mutate(
      refRatio = refCount / totalCount,
      altRatio = altCount / totalCount,
      WASP = TRUE
    ) %&gt;%
    dplyr::select(
      chromosome, position, allele, refRatio, altRatio, totalCount,
      sample, genotype, WASP
    )
}) %&gt;%
  bind_rows()</code></pre>
<p>Distributions of the reference allele ratio for all SNVs were visualised to determine if any mapping bias was present. Distributions showing balanced profile without 0 or 1 inflation are representative of no mapping bias.</p>
<pre class="r"><code>refRatios_nowasp %&gt;%
  left_join(metadata[,c(&quot;sample&quot;, &quot;genotype&quot;)]) %&gt;%
  dplyr::arrange(genotype, sample) %&gt;%
  ggplot(aes(refRatio, group = sample, colour = genotype)) +
  geom_density() +
  geom_vline(xintercept = 0.5, linetype = &quot;dashed&quot;) +
  labs(x = &quot;Reference allele ratio&quot;, y = &quot;Density&quot;, colour = &quot;Genotype&quot;) +
  theme(legend.position = &quot;bottom&quot;) +
  scale_color_manual(values = genoCols) +
  ggtitle(&quot;Reference allele ratio distributions without WASP filtering&quot;)</code></pre>
<div class="figure" style="text-align: center">
<img src="ase_qc_files/figure-html/unnamed-chunk-27-1.png" alt="*Sample distributions of global reference allelic ratios for remaining SNVs when no WASP filtering was applied. Distributions are coloured by genotype. All samples tend to follow a similar distribution with inflations towards 1, indicating that a reference allele mapping bias is present.*" width="768" />
<p class="caption">
<em>Sample distributions of global reference allelic ratios for remaining SNVs when no WASP filtering was applied. Distributions are coloured by genotype. All samples tend to follow a similar distribution with inflations towards 1, indicating that a reference allele mapping bias is present.</em>
</p>
</div>
<pre class="r"><code>refRatios_wasp %&gt;%
  left_join(metadata[,c(&quot;sample&quot;, &quot;genotype&quot;)]) %&gt;%
  dplyr::arrange(genotype, sample) %&gt;%
  ggplot(aes(refRatio, group = sample, colour = genotype)) +
  geom_density() +
  geom_vline(xintercept = 0.5, linetype = &quot;dashed&quot;) +
  labs(x = &quot;Reference allele ratio&quot;, y = &quot;Density&quot;, colour = &quot;Genotype&quot;) +
  theme(legend.position = &quot;bottom&quot;) +
  scale_color_manual(values = genoCols) +
  ggtitle(&quot;Reference allele ratio distributions with WASP filtering&quot;)</code></pre>
<div class="figure" style="text-align: center">
<img src="ase_qc_files/figure-html/unnamed-chunk-28-1.png" alt="*Sample distributions of global reference allelic ratios for remaining SNVs when WASP filtering was incorporated into the quality control procedure. Distributions are coloured by genotype. All samples show a reasonably balanced profile, indicating that WASP filtering successfully improved reference mapping bias.*" width="768" />
<p class="caption">
<em>Sample distributions of global reference allelic ratios for remaining SNVs when WASP filtering was incorporated into the quality control procedure. Distributions are coloured by genotype. All samples show a reasonably balanced profile, indicating that WASP filtering successfully improved reference mapping bias.</em>
</p>
</div>
<p>As an alternative viewpoint, boxplots of reference allele ratios were plotted for each sample. Median/mean reference allele ratios that deviate substantially from 0.5 indicate a mapping bias.</p>
<pre class="r"><code>refRatios_nowasp %&gt;%
  left_join(metadata[,c(&quot;sample&quot;, &quot;genotype&quot;)]) %&gt;%
  dplyr::arrange(genotype, sample) %&gt;%
  mutate(sample = factor(sample, levels = unique(sample))) %&gt;%
  ggplot(aes(sample, refRatio, fill = genotype)) +
  geom_boxplot(fatten = 3, outlier.shape = NA) +
  geom_hline(yintercept = 0.5, colour = &quot;black&quot;) +
  stat_summary(
    fun = mean, geom = &quot;point&quot;, colour = &quot;white&quot;, shape = &quot;\U2012&quot;, size = 6
  ) +
  labs(x = &quot;Sample&quot;, y = &quot;Reference allele ratio&quot;) +
  scale_fill_manual(name = &quot;Genotype&quot;, values = genoCols) +
  scale_y_continuous(breaks = seq(0, 1, 0.1)) +
  theme(
    axis.text.x = element_text(angle = -90, vjust = 0.5),
    legend.position = &quot;bottom&quot;
  ) +
  ggtitle(label = &quot;Reference allele ratios without WASP filtering&quot;)</code></pre>
<div class="figure" style="text-align: center">
<img src="ase_qc_files/figure-html/unnamed-chunk-29-1.png" alt="*Boxplots showing reference allele ratios for remaining SNVs when no WASP filtering was applied. The mean reference ratio for each sample is indicated with a white dash, while the solid black line indicates a reference ratio of 0.5. Outliers are hidden for the ease of viewing. As indicated by mean and median reference ratios above 0.5, reference mapping bias is evident.*" width="768" />
<p class="caption">
<em>Boxplots showing reference allele ratios for remaining SNVs when no WASP filtering was applied. The mean reference ratio for each sample is indicated with a white dash, while the solid black line indicates a reference ratio of 0.5. Outliers are hidden for the ease of viewing. As indicated by mean and median reference ratios above 0.5, reference mapping bias is evident.</em>
</p>
</div>
<pre class="r"><code>refRatios_wasp %&gt;%
  dplyr::filter(totalCount &gt;= 10) %&gt;%
  left_join(metadata[,c(&quot;sample&quot;, &quot;genotype&quot;)]) %&gt;%
  dplyr::arrange(genotype, sample) %&gt;%
  mutate(sample = factor(sample, levels = unique(sample))) %&gt;%
  ggplot(aes(sample, refRatio, fill = genotype)) +
  geom_boxplot(fatten = 3, outlier.shape = NA) +
  geom_hline(yintercept = 0.5, colour = &quot;black&quot;) +
  stat_summary(
    fun = mean, geom = &quot;point&quot;, colour = &quot;white&quot;, shape = &quot;\U2012&quot;, size = 6
  ) +
  labs(x = &quot;Sample&quot;, y = &quot;Reference allele ratio&quot;) +
  scale_fill_manual(name = &quot;Genotype&quot;, values = genoCols) +
  scale_y_continuous(breaks = seq(0, 1, 0.1)) +
  guides(colour = FALSE) +
  theme(
    axis.text.x = element_text(angle = -90, vjust = 0.5),
    legend.position = &quot;bottom&quot;
  ) +
  ggtitle(label = &quot;Reference allele ratios with WASP filtering&quot;)</code></pre>
<div class="figure" style="text-align: center">
<img src="ase_qc_files/figure-html/unnamed-chunk-30-1.png" alt="*Boxplots showing reference allele ratios for remaining SNVs when WASP filtering was incorporated into the quality control procedure. The mean reference ratio for each sample is indicated with a white dash, while the solid black line indicates a reference ratio of 0.5. Outliers are hidden for the ease of viewing. Reference mapping bias was eliminated in WASP filtered data and presents a significant improvement over data that was not subject to WASP.*" width="768" />
<p class="caption">
<em>Boxplots showing reference allele ratios for remaining SNVs when WASP filtering was incorporated into the quality control procedure. The mean reference ratio for each sample is indicated with a white dash, while the solid black line indicates a reference ratio of 0.5. Outliers are hidden for the ease of viewing. Reference mapping bias was eliminated in WASP filtered data and presents a significant improvement over data that was not subject to WASP.</em>
</p>
</div>
<p><code>WASP</code> filtered data showed a marginally improved reference allele mapping bias and was chosen for ASE testing.</p>
<pre class="r"><code>aseRC &lt;- aseRC_wasp
refRatios &lt;- refRatios_wasp
filtStats &lt;- filtProgress$wasp</code></pre>
<pre class="r"><code>refBias &lt;- refRatios %&gt;%
  bind_rows() %&gt;%
  group_by(sample) %&gt;%
  summarise(mean = mean(refRatio), median = median(refRatio))
altBias &lt;- refRatios %&gt;%
  bind_rows() %&gt;%
  group_by(sample) %&gt;%
  summarise(mean = mean(altRatio), median = median(altRatio))</code></pre>
<p>After quality control procedures, mean reference ratios ranged between 0.515 and 0.517. Median reference ratios ranged between 0.513 and 0.515. The mean reference ratios for each sample will be used as the null in statistical testing for ASE, as this can improve results <a href="https://www.biorxiv.org/content/biorxiv/early/2015/03/05/016097.full.pdf">(Castel et al.)</a>.</p>
</div>
<div id="filtering" class="section level3">
<h3>Filtering</h3>
<pre class="r"><code>filtStats %&gt;%
  dplyr::select(
    sample, `Within exons` = initial, GATK = GATK,
    `WASP/ASEReadCounter` = software,
    Coverage = coverage, `Mono-allelic expression` = monoallelic
  ) %&gt;%
  pivot_longer(cols = -sample, names_to = &quot;Filter&quot;, values_to = &quot;SNVs&quot;) %&gt;%
  mutate(Filter = factor(Filter, levels = unique(.$Filter))) %&gt;%
  ggplot(aes(Filter, SNVs, group = Filter, fill = Filter)) +
  geom_boxplot() +
  labs(y = &quot;Number of SNVs&quot;) +
  scale_y_continuous(labels = comma) +
  theme(
    legend.position = &quot;none&quot;,
    axis.title.x = element_blank(),
    panel.grid.major.x = element_blank()
  )</code></pre>
<div class="figure" style="text-align: center">
<img src="ase_qc_files/figure-html/unnamed-chunk-33-1.png" alt="*Boxplots of the total number of SNVs remaining in each sample after various quality control filtering steps. The filters were applied sequentially from left to right across the x-axis.*" width="768" />
<p class="caption">
<em>Boxplots of the total number of SNVs remaining in each sample after various quality control filtering steps. The filters were applied sequentially from left to right across the x-axis.</em>
</p>
</div>
</div>
<div id="coverage-1" class="section level3">
<h3>Coverage</h3>
<pre class="r"><code>covPlotA &lt;- lapply(aseRC, function(x){
  n10 &lt;- nrow(dplyr::filter(x, totalCount &gt;= 10))
  n20 &lt;- nrow(dplyr::filter(x, totalCount &gt;= 20))
  n30 &lt;- nrow(dplyr::filter(x, totalCount &gt;= 30))
  n40 &lt;- nrow(dplyr::filter(x, totalCount &gt;= 40))
  n50 &lt;- nrow(dplyr::filter(x, totalCount &gt;= 50))
  sample &lt;- unique(x$sample)
  tibble(
    bin = c(&quot;\u2265 10&quot;, &quot;\u2265 20&quot;, &quot;\u2265 30&quot;, &quot;\u2265 40&quot;, &quot;\u2265 50&quot;),
    n = c(n10, n20, n30, n40, n50),
    sample = sample
  )
}) %&gt;%
  bind_rows() %&gt;%
  ggplot(aes(bin, n, fill = bin)) +
  geom_boxplot() +
  labs(x = &quot;Reads / SNV&quot;, y = &quot;SNV count&quot;) +
  scale_y_continuous(
    breaks = seq(0, 100000, 10000),
    labels = comma
  ) +
  theme(
    legend.position = &quot;none&quot;,
    panel.grid.major.x = element_blank()
  )</code></pre>
<pre class="r"><code>exonOverlaps &lt;- lapply(aseRC, function(x){
  indices &lt;- x %&gt;%
    dplyr::select(seqnames = chromosome, start = position) %&gt;%
    mutate(end = start) %&gt;%
    makeGRangesFromDataFrame() %&gt;%
    findOverlaps(exons) %&gt;%
    as.data.frame()
  tibble(
    snvInd = indices$queryHits,
    geneInd = indices$subjectHits
  )
})
aseRCByGene &lt;- lapply(seq_along(aseRC), function(x){
  aseRC[[x]][exonOverlaps[[x]]$snvInd,] %&gt;%
    cbind(gene = names(exons[exonOverlaps[[x]]$geneInd])) %&gt;%
    as_tibble()
}) %&gt;% 
  set_names(names(aseRC))</code></pre>
<pre class="r"><code>covPlotB &lt;- lapply(aseRCByGene, function(x){
  n10 &lt;- length(unique(pull(dplyr::filter(x, totalCount &gt;= 10), gene)))
  n20 &lt;- length(unique(pull(dplyr::filter(x, totalCount &gt;= 20), gene)))
  n30 &lt;- length(unique(pull(dplyr::filter(x, totalCount &gt;= 30), gene)))
  n40 &lt;- length(unique(pull(dplyr::filter(x, totalCount &gt;= 40), gene)))
  n50 &lt;- length(unique(pull(dplyr::filter(x, totalCount &gt;= 50), gene)))
  sample &lt;- unique(x$sample)
  tibble(
    bin = c(&quot;\u2265 10&quot;, &quot;\u2265 20&quot;, &quot;\u2265 30&quot;, &quot;\u2265 40&quot;, &quot;\u2265 50&quot;),
    n = c(n10, n20, n30, n40, n50),
    sample = sample
  )
}) %&gt;%
  bind_rows() %&gt;%
  ggplot(aes(bin, n, fill = bin)) +
  geom_boxplot() +
  labs(x = &quot;Reads / SNV&quot;, y = &quot;Gene count&quot;) +
  scale_y_continuous(
    breaks = seq(0, 10000, 1000),
    labels = comma
  ) +
  theme(
    legend.position = &quot;none&quot;,
    panel.grid.major.x = element_blank()
  )</code></pre>
<pre class="r"><code>covPlotC &lt;- lapply(aseRCByGene, function(x){
  x %&gt;%
    dplyr::select(chromosome, position, totalCount, sample, gene) %&gt;%
    mutate(
      n10 = totalCount &gt;= 10,
      n20 = totalCount &gt;= 20,
      n30 = totalCount &gt;= 30,
      n40 = totalCount &gt;= 40,
      n50 = totalCount &gt;= 50
    ) %&gt;%
    group_by(gene) %&gt;%
    summarise(
      n10 = sum(n10),
      n20 = sum(n20),
      n30 = sum(n30),
      n40 = sum(n40), 
      n50 = sum(n50)
    ) %&gt;%
    ungroup() %&gt;%
    pivot_longer(
      cols = c(&quot;n10&quot;, &quot;n20&quot;, &quot;n30&quot;, &quot;n40&quot;, &quot;n50&quot;),
      names_to = &quot;bin&quot;,
      values_to = &quot;snvs&quot;
    ) %&gt;%
    group_by(bin, snvs) %&gt;%
    summarise(genes = n()) %&gt;%
    ungroup() %&gt;%
    dplyr::filter(snvs != 0)
}) %&gt;%
  bind_rows() %&gt;%
  group_by(bin, snvs) %&gt;%
  summarise(medianGenes = median(genes)) %&gt;%
  ggplot(aes(snvs, medianGenes, colour = bin)) +
  geom_point() +
  geom_line() +
  scale_colour_discrete(
    labels = c(&quot;\u2265 10&quot;, &quot;\u2265 20&quot;, &quot;\u2265 30&quot;, &quot;\u2265 40&quot;, &quot;\u2265 50&quot;)
  ) +
  scale_x_continuous(minor_breaks = seq(0, 30, 1)) +
  scale_y_continuous(
    breaks = seq(0, 5000, 100),
    labels = comma
  ) +
  coord_cartesian(xlim = c(0, 20)) +
  labs(x = &quot;SNVs / gene&quot;, y = &quot;Median gene count&quot;, colour = &quot;Coverage&quot;) +
  theme(legend.position= c(0.75, 0.75))</code></pre>
<pre class="r"><code>ggarrange(covPlotA, covPlotB, covPlotC, nrow = 1, labels = &quot;AUTO&quot;)</code></pre>
<div class="figure" style="text-align: center">
<img src="ase_qc_files/figure-html/unnamed-chunk-38-1.png" alt="*Genomic coverage of ASE data. **A**, **B** The number of SNVs (**A**) and protein coding genes (**B**) per sample at different read coverage cut-offs. **C** The number of protein coding genes against the number of SNVs they contain at different read coverage cut-offs. Each line represents the median value for all samples.*" width="768" />
<p class="caption">
<em>Genomic coverage of ASE data. <strong>A</strong>, <strong>B</strong> The number of SNVs (<strong>A</strong>) and protein coding genes (<strong>B</strong>) per sample at different read coverage cut-offs. <strong>C</strong> The number of protein coding genes against the number of SNVs they contain at different read coverage cut-offs. Each line represents the median value for all samples.</em>
</p>
</div>
</div>
<div id="export" class="section level3">
<h3>Export</h3>
<p>For static ASE testing, which describes the difference between two variants of a heterozygous allele in a single sample in an unchanging condition, <code>geneiASE</code> software was chosen. <code>geneiASE</code> requires allele counts <code>tsv</code> format with four columns: featureID, snpID, alternative allele count, reference allele count. <code>tsv</code> files (one for each sample) were exported for ASE testing.</p>
<pre class="r"><code>staticCounts &lt;- lapply(aseRCByGene, function(x){
  x %&gt;%
    rownames_to_column(&quot;snvID&quot;) %&gt;%
    left_join(altBias[,c(&quot;sample&quot;, &quot;mean&quot;)]) %&gt;%
    dplyr::select(
      gene, snvID, altCount, refCount, null.betabin.p = mean
    )
}) %&gt;%
  set_names(samples)
lapply(seq_along(staticCounts), function(x){
  path &lt;- file.path(
    &quot;/hpcfs/users/a1647910/210408_psen1_fADfAI/analysis-variants/13_geneiase/1_counts&quot;,
    paste0(names(staticCounts[x]), &quot;.static.tsv&quot;)
  )
  if (!file.exists(path)) {
    if (!dir.exists(dirname(path))) {
      dir.create(dirname(path), recursive = TRUE)
    }
    write_tsv(staticCounts[[x]], path)
  }
})</code></pre>
<p>The final quality controlled ASE count data was also exported in case it was needed in further analysis.</p>
<pre class="r"><code>path &lt;- here(&quot;files/aseRC.Rds&quot;)
if (!file.exists(path)) {
  saveRDS(aseRC, path)
}</code></pre>
<pre class="r"><code>path &lt;- here(&quot;files/aseRCByGene.Rds&quot;)
if (!file.exists(path)) {
  saveRDS(aseRCByGene, path)
}</code></pre>
</div>
</div>
<div id="session-information" class="section level1">
<h1>Session information</h1>
<pre class="r"><code>sessionInfo() %&gt;%
  pander()</code></pre>
<p><strong>R version 4.1.2 (2021-11-01)</strong></p>
<p><strong>Platform:</strong> x86_64-pc-linux-gnu (64-bit)</p>
<p><strong>locale:</strong> <em>LC_CTYPE=en_AU.UTF-8</em>, <em>LC_NUMERIC=C</em>, <em>LC_TIME=en_AU.UTF-8</em>, <em>LC_COLLATE=en_AU.UTF-8</em>, <em>LC_MONETARY=en_AU.UTF-8</em>, <em>LC_MESSAGES=en_AU.UTF-8</em>, <em>LC_PAPER=en_AU.UTF-8</em>, <em>LC_NAME=C</em>, <em>LC_ADDRESS=C</em>, <em>LC_TELEPHONE=C</em>, <em>LC_MEASUREMENT=en_AU.UTF-8</em> and <em>LC_IDENTIFICATION=C</em></p>
<p><strong>attached base packages:</strong> <em>stats4</em>, <em>parallel</em>, <em>stats</em>, <em>graphics</em>, <em>grDevices</em>, <em>utils</em>, <em>datasets</em>, <em>methods</em> and <em>base</em></p>
<p><strong>other attached packages:</strong> <em>ensembldb(v.2.16.4)</em>, <em>AnnotationFilter(v.1.16.0)</em>, <em>GenomicFeatures(v.1.44.2)</em>, <em>AnnotationDbi(v.1.54.1)</em>, <em>Biobase(v.2.52.0)</em>, <em>GenomicRanges(v.1.44.0)</em>, <em>GenomeInfoDb(v.1.28.4)</em>, <em>IRanges(v.2.26.0)</em>, <em>S4Vectors(v.0.30.2)</em>, <em>ngsReports(v.1.8.1)</em>, <em>SeqArray(v.1.32.0)</em>, <em>gdsfmt(v.1.28.1)</em>, <em>UpSetR(v.1.4.0)</em>, <em>rmarkdown(v.2.11)</em>, <em>pander(v.0.6.4)</em>, <em>ggpubr(v.0.4.0)</em>, <em>RColorBrewer(v.1.1-2)</em>, <em>ggrepel(v.0.9.1)</em>, <em>tictoc(v.1.0.1)</em>, <em>kableExtra(v.1.3.4)</em>, <em>scales(v.1.1.1)</em>, <em>AnnotationHub(v.3.0.2)</em>, <em>BiocFileCache(v.2.0.0)</em>, <em>dbplyr(v.2.1.1)</em>, <em>BiocGenerics(v.0.38.0)</em>, <em>here(v.1.0.1)</em>, <em>future.apply(v.1.8.1)</em>, <em>future(v.1.22.1)</em>, <em>magrittr(v.2.0.1)</em>, <em>forcats(v.0.5.1)</em>, <em>stringr(v.1.4.0)</em>, <em>dplyr(v.1.0.7)</em>, <em>purrr(v.0.3.4)</em>, <em>readr(v.2.0.2)</em>, <em>tidyr(v.1.1.4)</em>, <em>tibble(v.3.1.5)</em>, <em>ggplot2(v.3.3.5)</em> and <em>tidyverse(v.1.3.1)</em></p>
<p><strong>loaded via a namespace (and not attached):</strong> <em>readxl(v.1.3.1)</em>, <em>backports(v.1.3.0)</em>, <em>systemfonts(v.1.0.3)</em>, <em>plyr(v.1.8.6)</em>, <em>lazyeval(v.0.2.2)</em>, <em>BiocParallel(v.1.26.2)</em>, <em>listenv(v.0.8.0)</em>, <em>digest(v.0.6.28)</em>, <em>htmltools(v.0.5.2)</em>, <em>fansi(v.0.5.0)</em>, <em>memoise(v.2.0.0)</em>, <em>tzdb(v.0.2.0)</em>, <em>openxlsx(v.4.2.4)</em>, <em>globals(v.0.14.0)</em>, <em>Biostrings(v.2.60.2)</em>, <em>modelr(v.0.1.8)</em>, <em>matrixStats(v.0.61.0)</em>, <em>vroom(v.1.5.5)</em>, <em>svglite(v.2.0.0)</em>, <em>prettyunits(v.1.1.1)</em>, <em>colorspace(v.2.0-2)</em>, <em>blob(v.1.2.2)</em>, <em>rvest(v.1.0.2)</em>, <em>rappdirs(v.0.3.3)</em>, <em>haven(v.2.4.3)</em>, <em>xfun(v.0.27)</em>, <em>crayon(v.1.4.1)</em>, <em>RCurl(v.1.98-1.5)</em>, <em>jsonlite(v.1.7.2)</em>, <em>zoo(v.1.8-9)</em>, <em>glue(v.1.4.2)</em>, <em>gtable(v.0.3.0)</em>, <em>zlibbioc(v.1.38.0)</em>, <em>XVector(v.0.32.0)</em>, <em>webshot(v.0.5.2)</em>, <em>DelayedArray(v.0.18.0)</em>, <em>car(v.3.0-11)</em>, <em>abind(v.1.4-5)</em>, <em>DBI(v.1.1.1)</em>, <em>rstatix(v.0.7.0)</em>, <em>Rcpp(v.1.0.7)</em>, <em>progress(v.1.2.2)</em>, <em>viridisLite(v.0.4.0)</em>, <em>xtable(v.1.8-4)</em>, <em>foreign(v.0.8-82)</em>, <em>bit(v.4.0.4)</em>, <em>DT(v.0.19)</em>, <em>htmlwidgets(v.1.5.4)</em>, <em>httr(v.1.4.2)</em>, <em>ellipsis(v.0.3.2)</em>, <em>farver(v.2.1.0)</em>, <em>XML(v.3.99-0.8)</em>, <em>pkgconfig(v.2.0.3)</em>, <em>sass(v.0.4.0)</em>, <em>utf8(v.1.2.2)</em>, <em>labeling(v.0.4.2)</em>, <em>tidyselect(v.1.1.1)</em>, <em>rlang(v.0.4.12)</em>, <em>later(v.1.3.0)</em>, <em>munsell(v.0.5.0)</em>, <em>BiocVersion(v.3.13.1)</em>, <em>cellranger(v.1.1.0)</em>, <em>tools(v.4.1.2)</em>, <em>cachem(v.1.0.6)</em>, <em>cli(v.3.1.0)</em>, <em>generics(v.0.1.1)</em>, <em>RSQLite(v.2.2.8)</em>, <em>broom(v.0.7.9)</em>, <em>ggdendro(v.0.1.22)</em>, <em>evaluate(v.0.14)</em>, <em>fastmap(v.1.1.0)</em>, <em>yaml(v.2.2.1)</em>, <em>knitr(v.1.36)</em>, <em>bit64(v.4.0.5)</em>, <em>fs(v.1.5.0)</em>, <em>zip(v.2.2.0)</em>, <em>KEGGREST(v.1.32.0)</em>, <em>mime(v.0.12)</em>, <em>xml2(v.1.3.2)</em>, <em>biomaRt(v.2.48.3)</em>, <em>compiler(v.4.1.2)</em>, <em>rstudioapi(v.0.13)</em>, <em>plotly(v.4.10.0)</em>, <em>filelock(v.1.0.2)</em>, <em>curl(v.4.3.2)</em>, <em>png(v.0.1-7)</em>, <em>interactiveDisplayBase(v.1.30.0)</em>, <em>ggsignif(v.0.6.3)</em>, <em>reprex(v.2.0.1)</em>, <em>bslib(v.0.3.1)</em>, <em>stringi(v.1.7.5)</em>, <em>highr(v.0.9)</em>, <em>lattice(v.0.20-45)</em>, <em>ProtGenerics(v.1.24.0)</em>, <em>Matrix(v.1.4-0)</em>, <em>vctrs(v.0.3.8)</em>, <em>pillar(v.1.6.4)</em>, <em>lifecycle(v.1.0.1)</em>, <em>BiocManager(v.1.30.16)</em>, <em>jquerylib(v.0.1.4)</em>, <em>cowplot(v.1.1.1)</em>, <em>data.table(v.1.14.2)</em>, <em>bitops(v.1.0-7)</em>, <em>rtracklayer(v.1.52.1)</em>, <em>httpuv(v.1.6.3)</em>, <em>BiocIO(v.1.2.0)</em>, <em>R6(v.2.5.1)</em>, <em>promises(v.1.2.0.1)</em>, <em>gridExtra(v.2.3)</em>, <em>rio(v.0.5.27)</em>, <em>parallelly(v.1.28.1)</em>, <em>codetools(v.0.2-18)</em>, <em>MASS(v.7.3-55)</em>, <em>assertthat(v.0.2.1)</em>, <em>SummarizedExperiment(v.1.22.0)</em>, <em>rjson(v.0.2.20)</em>, <em>rprojroot(v.2.0.2)</em>, <em>withr(v.2.4.2)</em>, <em>GenomicAlignments(v.1.28.0)</em>, <em>Rsamtools(v.2.8.0)</em>, <em>GenomeInfoDbData(v.1.2.6)</em>, <em>hms(v.1.1.1)</em>, <em>grid(v.4.1.2)</em>, <em>MatrixGenerics(v.1.4.3)</em>, <em>carData(v.3.0-4)</em>, <em>shiny(v.1.7.1)</em>, <em>lubridate(v.1.8.0)</em> and <em>restfulr(v.0.0.13)</em></p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
